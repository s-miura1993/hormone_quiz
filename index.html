<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>内分泌系ホルモンクイズ（生物基礎）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      line-height: 1.6;
      padding: 20px;
      max-width: 900px;
      margin: 0 auto;
      background: #f3f4f6;
      transition: background 0.2s ease;
    }
    body.review-mode {
      background: #fef2f2; /* 復習モード時の背景色（うすい赤） */
    }
    header {
      margin-bottom: 1rem;
    }
    h1 {
      font-size: 1.6rem;
      margin-bottom: 0.2rem;
    }
    .tagline {
      color: #555;
      font-size: 0.9rem;
      margin-bottom: 1rem;
    }
    #app-card {
      background: #ffffff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      transition: background 0.2s ease;
      border: 2px solid transparent;
    }
    #app-card.review-mode {
      border: none;      /* 枠線なし */
      box-shadow: none;  /* 外枠の強調もなし */
      background: #fff7ed;
    }
    #status-bar {
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
      margin-bottom: 10px;
      color: #444;
      gap: 8px;
      flex-wrap: wrap;
    }
    #question-text {
      font-weight: 600;
      margin-bottom: 12px;
    }
    .choices {
      list-style: none;
      padding: 0;
      margin: 0 0 12px 0;
    }
    .choices li {
      margin-bottom: 8px;
    }
    .choice-btn {
      width: 100%;
      text-align: left;
      border-radius: 999px;
      border: 1px solid #ddd;
      padding: 10px 14px;
      background: #fafafa;
      cursor: pointer;
      font-size: 0.95rem;
      transition: background 0.15s, transform 0.05s, box-shadow 0.15s, border-color 0.15s;
    }
    .choice-btn:hover {
      background: #f0f0f0;
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
      transform: translateY(-1px);
    }
    .choice-btn.correct {
      background: #e0f8e7;
      border-color: #35a56f;
    }
    .choice-btn.incorrect {
      background: #ffe5e5;
      border-color: #d9534f;
    }
    #feedback {
      min-height: 1.4em;
      margin-bottom: 4px;
      font-weight: 600;
    }
    #feedback.correct {
      color: #2b8a3e;
    }
    #feedback.incorrect {
      color: #c0392b;
    }
    #wrong-count {
      font-size: 0.85rem;
      color: #6b7280;
      margin-bottom: 6px;
      min-height: 1.2em;
    }
    /* 解説ボックスを目立たせる */
    #explanation {
      font-size: 0.9rem;
      color: #111827;
      margin-bottom: 14px;
      min-height: 1.2em;
      padding: 10px 12px;
      border-radius: 8px;
      background: #eef2ff;              /* うすい青の背景で目立たせる */
      border-left: 4px solid #4f46e5;   /* 左に色付きライン */
      display: none;                    /* デフォルトでは非表示 */
    }
    #explanation.visible {
      display: block;                   /* 解答後に表示 */
    }
    #controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
      gap: 8px;
      flex-wrap: wrap;
    }
    #next-btn, #restart-btn, #reset-stat-btn {
      border-radius: 999px;
      border: none;
      padding: 8px 16px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background 0.15s, box-shadow 0.15s, transform 0.05s;
    }
    #next-btn {
      background: #2563eb;
      color: #fff;
    }
    #next-btn:disabled {
      background: #9cb5f2;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }
    #restart-btn {
      background: #e5e7eb;
      color: #111827;
    }
    #reset-stat-btn {
      background: #fee2e2;
      color: #991b1b;
    }
    #next-btn:hover:not(:disabled),
    #restart-btn:hover,
    #reset-stat-btn:hover {
      box-shadow: 0 1px 4px rgba(0,0,0,0.15);
      transform: translateY(-1px);
    }
    #mode-info {
      font-size: 0.8rem;
      color: #6b7280;
    }
    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
      background: #eef2ff;
      color: #3730a3;
      margin-left: 4px;
    }
    #mode-select {
      font-size: 0.8rem;
      color: #374151;
      margin-bottom: 8px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
    }
    #mode-select label {
      margin-right: 10px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    /* 復習モードラベルを特別に大きく＆目立たせる */
    #mode-select label.review-label {
      padding: 4px 12px;
      border-radius: 999px;
      border: 2px solid #f97316;
      background: #fff7ed;
      font-weight: 600;
      font-size: 0.9rem;
    }
    #mode-select label.review-label input {
      transform: scale(1.2);
    }
    #mode-select label.review-label.active {
      background: #fed7aa;
      border-color: #ea580c;
      box-shadow: 0 0 0 2px rgba(248,113,113,0.35);
    }
  </style>
</head>
<body>
  <header>
    <h1>内分泌系ホルモンクイズ</h1>
    <div class="tagline">
      高校「生物基礎」 内分泌系（指定13ホルモンのみ）
      <span class="badge">GitHub Pages</span>
      <span class="badge">選択肢シャッフル</span>
      <span class="badge">復習モード</span>
      <span class="badge">50問プールから20問ランダム</span>
    </div>
  </header>

  <main id="app-card">
    <div id="mode-select">
      出題モード：
      <label for="mode-all">
        <input type="radio" id="mode-all" name="mode" value="all" checked />
        全問題プールから20問
      </label>
      <label for="mode-mc">
        <input type="radio" id="mode-mc" name="mode" value="mc" />
        四択問題だけから20問
      </label>
      <label for="mode-tf">
        <input type="radio" id="mode-tf" name="mode" value="tf" />
        正誤（二択）だけから20問
      </label>
      <label for="mode-review" class="review-label">
        <input type="radio" id="mode-review" name="mode" value="review" />
        ★ よく間違える問題（復習）
      </label>
    </div>

    <div id="status-bar">
      <div>問題 <span id="question-number"></span> / <span id="total-questions"></span></div>
      <div>正答数：<span id="score">0</span></div>
    </div>

    <div id="question-text"></div>
    <ul class="choices" id="choices-list"></ul>

    <div id="feedback"></div>
    <div id="wrong-count"></div>
    <div id="explanation"></div>

    <div id="controls">
      <button id="next-btn" disabled>次の問題へ ▶</button>
      <button id="restart-btn">もう一度ランダムに20問解く</button>
      <button id="reset-stat-btn" title="この端末に保存された間違いデータを消去します">復習データをリセット</button>
      <div id="mode-info">※この端末のブラウザに「よく間違える問題」の履歴を保存します。</div>
    </div>
  </main>

  <script>
    // クイズデータ: type: "mc" = 四択, "tf" = 正誤（二択）
    // ホルモンは指定の13種類のみ使用
    const QUESTIONS = [
      {
        id: 1,
        type: "mc",
        question: "副腎髄質から分泌されるホルモンはどれか。",
        choices: ["アドレナリン", "グルカゴン", "インスリン", "糖質コルチコイド"],
        correctIndex: 0,
        explanation: "副腎髄質は、交感神経の刺激に応じてアドレナリンを分泌し、血糖値上昇や心拍数増加などを引き起こします。"
      },
      {
        id: 2,
        type: "mc",
        question: "血糖値を下げる働きをもつ唯一のホルモンはどれか。",
        choices: ["グルカゴン", "アドレナリン", "インスリン", "糖質コルチコイド"],
        correctIndex: 2,
        explanation: "血糖値を下げるホルモンはインスリンのみで、すい臓ランゲルハンス島B細胞から分泌されます。"
      },
      {
        id: 3,
        type: "mc",
        question: "血糖値を上げるホルモンの組み合わせとして正しいものはどれか。",
        choices: [
          "アドレナリン＋グルカゴン",
          "インスリン＋チロキシン",
          "バソプレシン＋鉱質コルチコイド",
          "インスリン＋成長ホルモン"
        ],
        correctIndex: 0,
        explanation: "アドレナリンとグルカゴンはいずれも血糖値を上昇させるホルモンです。"
      },
      {
        id: 4,
        type: "mc",
        question: "脳下垂体前葉から分泌されるホルモンはどれか。",
        choices: ["成長ホルモン", "バソプレシン", "インスリン", "チロキシン"],
        correctIndex: 0,
        explanation: "成長ホルモンは脳下垂体前葉から分泌され、タンパク質合成促進や血糖値上昇などに関与します。"
      },
      {
        id: 5,
        type: "mc",
        question: "甲状腺を刺激してチロキシン分泌を促すホルモンはどれか。",
        choices: ["放出ホルモン", "甲状腺刺激ホルモン", "副腎皮質刺激ホルモン", "パラトルモン"],
        correctIndex: 1,
        explanation: "甲状腺刺激ホルモン（TSH）は脳下垂体前葉から分泌され、甲状腺に作用してチロキシン分泌を促します。"
      },
      {
        id: 6,
        type: "mc",
        question: "副腎皮質を刺激するホルモンはどれか。",
        choices: ["副腎皮質刺激ホルモン", "鉱質コルチコイド", "糖質コルチコイド", "放出抑制ホルモン"],
        correctIndex: 0,
        explanation: "副腎皮質刺激ホルモン（ACTH）は脳下垂体前葉から分泌され、副腎皮質に働きかけて糖質コルチコイドなどの分泌を促します。"
      },
      {
        id: 7,
        type: "mc",
        question: "バソプレシンの主な作用はどれか。",
        choices: [
          "血中カルシウム濃度を上げる",
          "腎臓での水の再吸収を促進する",
          "代謝率を上げる",
          "血糖値を上げる"
        ],
        correctIndex: 1,
        explanation: "バソプレシン（抗利尿ホルモン）は腎臓で水の再吸収を促進し、尿量を減らします。"
      },
      {
        id: 8,
        type: "mc",
        question: "チロキシンの主な働きとして正しいものはどれか。",
        choices: [
          "血糖値を下げる",
          "代謝を促進する",
          "尿量を増やす",
          "血中カルシウム濃度を上げる"
        ],
        correctIndex: 1,
        explanation: "チロキシン（甲状腺ホルモン）は全身の代謝を促進し、成長やエネルギー代謝に重要な役割を果たします。"
      },
      {
        id: 9,
        type: "mc",
        question: "血中カルシウム濃度を上げる作用をもつホルモンはどれか。",
        choices: ["パラトルモン", "インスリン", "アドレナリン", "成長ホルモン"],
        correctIndex: 0,
        explanation: "パラトルモン（副甲状腺ホルモン）は骨からのカルシウムの溶出などを促進し、血中カルシウム濃度を上昇させます。"
      },
      {
        id: 10,
        type: "mc",
        question: "糖質コルチコイドの働きとして正しいものはどれか。",
        choices: [
          "血糖値を上げる",
          "血糖値を下げる",
          "尿量を減らす",
          "代謝を抑制する"
        ],
        correctIndex: 0,
        explanation: "糖質コルチコイド（コルチゾールなど）は糖新生を促進し、血糖値を上昇させます。"
      },
      {
        id: 11,
        type: "mc",
        question: "鉱質コルチコイドの作用として正しいものはどれか。",
        choices: [
          "ナトリウム再吸収を促進する",
          "血糖値を下げる",
          "代謝を促進する",
          "副腎髄質を刺激する"
        ],
        correctIndex: 0,
        explanation: "鉱質コルチコイド（アルドステロンなど）は腎臓でNa⁺の再吸収を促進し、水分量と血圧の調節に関わります。"
      },
      {
        id: 12,
        type: "mc",
        question: "グルカゴンが主に作用する組織はどれか。",
        choices: ["腎臓", "肝臓", "甲状腺", "副腎皮質"],
        correctIndex: 1,
        explanation: "グルカゴンは肝臓に働き、グリコーゲン分解などを通じて血糖値を上昇させます。"
      },
      {
        id: 13,
        type: "mc",
        question: "成長ホルモンの働きとして最も適当なものはどれか。",
        choices: [
          "血糖値を上げる",
          "血糖値を下げる",
          "カルシウム濃度を下げる",
          "アドレナリンの分泌を抑える"
        ],
        correctIndex: 0,
        explanation: "成長ホルモンはタンパク質合成促進のほか、脂肪分解などを通じて血糖値を上昇させる作用もあります。"
      },
      {
        id: 14,
        type: "mc",
        question: "放出ホルモンが分泌される場所はどれか。",
        choices: ["甲状腺", "脳下垂体前葉", "視床下部", "副腎皮質"],
        correctIndex: 2,
        explanation: "放出ホルモン（放出因子）は視床下部から分泌され、脳下垂体前葉ホルモンの分泌を促進します。"
      },
      {
        id: 15,
        type: "mc",
        question: "放出抑制ホルモンの働きとして正しいものはどれか。",
        choices: [
          "脳下垂体ホルモンの分泌を促進する",
          "脳下垂体ホルモンの分泌を抑制する",
          "副腎皮質を刺激する",
          "血糖値を下げる"
        ],
        correctIndex: 1,
        explanation: "放出抑制ホルモン（抑制因子）は視床下部から分泌され、脳下垂体前葉ホルモンの分泌を抑制します。"
      },
      {
        id: 16,
        type: "mc",
        question: "次のうち、すい臓ランゲルハンス島A細胞から分泌されるホルモンはどれか。",
        choices: ["グルカゴン", "インスリン", "バソプレシン", "チロキシン"],
        correctIndex: 0,
        explanation: "ランゲルハンス島A細胞からはグルカゴンが分泌されます。B細胞からはインスリンが分泌されます。"
      },
      {
        id: 17,
        type: "mc",
        question: "甲状腺から分泌されるホルモンはどれか。",
        choices: ["チロキシン", "インスリン", "鉱質コルチコイド", "バソプレシン"],
        correctIndex: 0,
        explanation: "甲状腺から分泌される代表的なホルモンがチロキシンです。"
      },
      {
        id: 18,
        type: "mc",
        question: "副甲状腺から分泌されるホルモンはどれか。",
        choices: ["パラトルモン", "甲状腺刺激ホルモン", "糖質コルチコイド", "バソプレシン"],
        correctIndex: 0,
        explanation: "副甲状腺（上皮小体）から分泌されるのがパラトルモンで、血中カルシウム濃度を上昇させます。"
      },
      {
        id: 19,
        type: "mc",
        question: "副腎皮質から分泌されるホルモンの組み合わせとして正しいものはどれか。",
        choices: [
          "糖質コルチコイド＋鉱質コルチコイド",
          "アドレナリン＋グルカゴン",
          "インスリン＋グルカゴン",
          "チロキシン＋パラトルモン"
        ],
        correctIndex: 0,
        explanation: "副腎皮質では糖質コルチコイドや鉱質コルチコイドなどが分泌されます。"
      },
      {
        id: 20,
        type: "mc",
        question: "ストレス時に長期的に血糖値を上げる働きが最も大きいホルモンはどれか。",
        choices: ["糖質コルチコイド", "アドレナリン", "インスリン", "バソプレシン"],
        correctIndex: 0,
        explanation: "ストレスが長期化したときには糖質コルチコイドが働き、糖新生を促して血糖値を上げます。"
      },
      {
        id: 21,
        type: "tf",
        question: "アドレナリンは副腎髄質から分泌される。",
        choices: ["正しい", "誤り"],
        correctIndex: 0,
        explanation: "アドレナリンは副腎髄質から分泌されるホルモンで、血糖値上昇や心拍数増加に関与します。"
      },
      {
        id: 22,
        type: "tf",
        question: "インスリンはすい臓から分泌され、血糖値を下げる働きをもつ。",
        choices: ["正しい", "誤り"],
        correctIndex: 0,
        explanation: "インスリンはすい臓ランゲルハンス島B細胞から分泌され、血糖値を下げます。"
      },
      {
        id: 23,
        type: "tf",
        question: "グルカゴンは血糖値を下げる働きをもつ。",
        choices: ["正しい", "誤り"],
        correctIndex: 1,
        explanation: "グルカゴンは血糖値を上げる方向に働くホルモンです。"
      },
      {
        id: 24,
        type: "tf",
        question: "鉱質コルチコイドは腎臓でナトリウムの再吸収を促進する。",
        choices: ["正しい", "誤り"],
        correctIndex: 0,
        explanation: "鉱質コルチコイド（アルドステロンなど）はNa⁺の再吸収を促し、体液量や血圧の調節に関与します。"
      },
      {
        id: 25,
        type: "tf",
        question: "放出ホルモンは脳下垂体前葉から分泌される。",
        choices: ["正しい", "誤り"],
        correctIndex: 1,
        explanation: "放出ホルモンは視床下部から分泌され、脳下垂体前葉ホルモンの分泌を促進します。"
      },
      {
        id: 26,
        type: "tf",
        question: "甲状腺刺激ホルモンは脳下垂体前葉から分泌される。",
        choices: ["正しい", "誤り"],
        correctIndex: 0,
        explanation: "甲状腺刺激ホルモン（TSH）は脳下垂体前葉ホルモンの一つです。"
      },
      {
        id: 27,
        type: "tf",
        question: "パラトルモンは血中カルシウム濃度を下げる働きをもつ。",
        choices: ["正しい", "誤り"],
        correctIndex: 1,
        explanation: "パラトルモンは血中カルシウム濃度を上昇させる方向に働きます。"
      },
      {
        id: 28,
        type: "tf",
        question: "バソプレシンは腎臓での水の再吸収を抑制し、尿量を増やす。",
        choices: ["正しい", "誤り"],
        correctIndex: 1,
        explanation: "バソプレシンは水の再吸収を促進し、尿量を減らす（抗利尿）のが主な作用です。"
      },
      {
        id: 29,
        type: "tf",
        question: "チロキシンは代謝を促進する作用をもつ。",
        choices: ["正しい", "誤り"],
        correctIndex: 0,
        explanation: "チロキシン（甲状腺ホルモン）は代謝率を高め、成長やエネルギー代謝に重要です。"
      },
      {
        id: 30,
        type: "tf",
        question: "糖質コルチコイドとアドレナリンはいずれも血糖値を上昇させる。",
        choices: ["正しい", "誤り"],
        correctIndex: 0,
        explanation: "どちらも血糖値を上昇させるホルモンですが、糖質コルチコイドは比較的長期的、アドレナリンは急性的なストレス応答で働きます。"
      },

      /* ここから追加の20問（31〜50） */

      {
        id: 31,
        type: "mc",
        question: "ホルモンと分泌腺の組み合わせとして正しいものはどれか。",
        choices: [
          "インスリン ― 副腎皮質",
          "チロキシン ― 甲状腺",
          "アドレナリン ― すい臓",
          "パラトルモン ― 脳下垂体前葉"
        ],
        correctIndex: 1,
        explanation: "チロキシンは甲状腺から分泌されます。インスリンはすい臓、アドレナリンは副腎髄質、パラトルモンは副甲状腺から分泌されます。"
      },
      {
        id: 32,
        type: "mc",
        question: "血糖値が低下したときに主に働くホルモンとその作用の組み合わせとして最も適当なものはどれか。",
        choices: [
          "グルカゴン ― 肝臓でグリコーゲン分解を促進する",
          "インスリン ― 肝臓でグリコーゲン分解を促進する",
          "チロキシン ― すい臓でインスリン分泌を抑制する",
          "糖質コルチコイド ― すい臓でグルカゴン分泌を抑制する"
        ],
        correctIndex: 0,
        explanation: "血糖値が下がるとグルカゴンが分泌され、肝臓でグリコーゲン分解を進めて血糖値を上げます。"
      },
      {
        id: 33,
        type: "mc",
        question: "体液の浸透圧が上昇したときに分泌が増えるホルモンはどれか。",
        choices: ["バソプレシン", "インスリン", "アドレナリン", "小腸ホルモン"],
        correctIndex: 0,
        explanation: "体液の浸透圧上昇時にはバソプレシンの分泌が増え、腎臓での水再吸収を促進して薄める方向に働きます。"
      },
      {
        id: 34,
        type: "mc",
        question: "次のうち、副腎髄質ホルモン（アドレナリン）の作用ではないものはどれか。",
        choices: [
          "心拍数の増加",
          "血糖値の上昇",
          "気管支の拡張",
          "血中カルシウム濃度の上昇"
        ],
        correctIndex: 3,
        explanation: "血中カルシウム濃度の上昇は主にパラトルモンの作用であり、アドレナリンの典型的な作用ではありません。"
      },
      {
        id: 35,
        type: "mc",
        question: "インスリンの作用について正しい記述はどれか。",
        choices: [
          "肝臓でグリコーゲン分解を促進し血糖値を上げる",
          "骨からカルシウムを溶出させる",
          "グルコースをグリコーゲンとして肝臓や筋肉に蓄えることを促す",
          "腎臓で水の再吸収を促進する"
        ],
        correctIndex: 2,
        explanation: "インスリンはグルコースをグリコーゲンとして蓄える働きなどを通して血糖値を下げます。"
      },
      {
        id: 36,
        type: "mc",
        question: "視床下部―脳下垂体前葉―甲状腺の調節で、正しい順序を示すものはどれか。",
        choices: [
          "放出ホルモン → 甲状腺刺激ホルモン → チロキシン",
          "甲状腺刺激ホルモン → 放出ホルモン → チロキシン",
          "チロキシン → 甲状腺刺激ホルモン → 放出ホルモン",
          "チロキシン → 放出ホルモン → 甲状腺刺激ホルモン"
        ],
        correctIndex: 0,
        explanation: "視床下部の放出ホルモンが脳下垂体前葉を刺激し、甲状腺刺激ホルモンが分泌され、甲状腺に作用してチロキシンが分泌されます。"
      },
      {
        id: 37,
        type: "mc",
        question: "成長ホルモンの分泌が長期間過剰になると起こりやすい状態として最も適当なものはどれか。",
        choices: [
          "低血糖が続く",
          "身長や骨の成長が過度に進む",
          "血中カルシウム濃度が著しく下がる",
          "尿量が極端に増える"
        ],
        correctIndex: 1,
        explanation: "成長ホルモンの過剰分泌は、成長期では巨人症、成人では末端肥大症など、骨や身体の過剰な成長を引き起こします。"
      },
      {
        id: 38,
        type: "mc",
        question: "チロキシンの分泌低下でみられる症状として適当なものはどれか。",
        choices: [
          "代謝が低下し寒がりになる",
          "血糖値が著しく上昇する",
          "尿量が極端に増える",
          "血中カルシウム濃度が上昇する"
        ],
        correctIndex: 0,
        explanation: "チロキシンが減ると代謝が低下し、寒がり・むくみなどの症状が出やすくなります。"
      },
      {
        id: 39,
        type: "mc",
        question: "副腎皮質刺激ホルモン（ACTH）の分泌を促す直接の原因として正しいものはどれか。",
        choices: [
          "視床下部からの放出ホルモン",
          "副腎皮質からの糖質コルチコイド",
          "副腎髄質からのアドレナリン",
          "甲状腺からのチロキシン"
        ],
        correctIndex: 0,
        explanation: "ACTHは視床下部の放出ホルモンによって分泌が促進されます。"
      },
      {
        id: 40,
        type: "mc",
        question: "放出ホルモンが働く標的器官として最も適当なものはどれか。",
        choices: ["脳下垂体前葉", "脳下垂体後葉", "副腎皮質", "すい臓"],
        correctIndex: 0,
        explanation: "放出ホルモン（放出因子）は視床下部から分泌され、脳下垂体前葉ホルモンの分泌を調節します。"
      },
      {
        id: 41,
        type: "tf",
        question: "糖質コルチコイドは、長期のストレス時に多く分泌される副腎皮質ホルモンである。",
        choices: ["正しい", "誤り"],
        correctIndex: 0,
        explanation: "長期ストレス時には糖質コルチコイドが増え、血糖値の維持などに働きます。"
      },
      {
        id: 42,
        type: "tf",
        question: "インスリンは、肝臓に働いてグリコーゲン分解を促進し、血糖値を上昇させる。",
        choices: ["正しい", "誤り"],
        correctIndex: 1,
        explanation: "グリコーゲン分解を促進して血糖値を上げるのはグルカゴンなどであり、インスリンは逆に血糖値を下げます。"
      },
      {
        id: 43,
        type: "tf",
        question: "グルカゴンは、肝臓に働いてグリコーゲン分解を促進し、血糖値を上昇させる。",
        choices: ["正しい", "誤り"],
        correctIndex: 0,
        explanation: "グルカゴンは肝臓でのグリコーゲン分解や糖新生を促進し、血糖値を上昇させます。"
      },
      {
        id: 44,
        type: "tf",
        question: "チロキシンの分泌が増えると、負のフィードバックにより甲状腺刺激ホルモンの分泌は抑えられる。",
        choices: ["正しい", "誤り"],
        correctIndex: 0,
        explanation: "チロキシン濃度が高くなると、視床下部・脳下垂体に働いて甲状腺刺激ホルモンの分泌を抑える負のフィードバックがはたらきます。"
      },
      {
        id: 45,
        type: "tf",
        question: "バソプレシンは脳下垂体前葉から分泌される。",
        choices: ["正しい", "誤り"],
        correctIndex: 1,
        explanation: "バソプレシン（抗利尿ホルモン）は視床下部で合成され、脳下垂体後葉から分泌されます。"
      },
      {
        id: 46,
        type: "tf",
        question: "鉱質コルチコイドは腎臓でのナトリウム再吸収を促進し、その結果、水分の保持にもつながる。",
        choices: ["正しい", "誤り"],
        correctIndex: 0,
        explanation: "鉱質コルチコイドはNa⁺再吸収を促し、それに伴って水分も保持されるため、血圧維持に関わります。"
      },
      {
        id: 47,
        type: "tf",
        question: "副甲状腺は甲状腺の内部にあり、チロキシンを分泌する。",
        choices: ["正しい", "誤り"],
        correctIndex: 1,
        explanation: "副甲状腺（上皮小体）は甲状腺の裏側に位置し、パラトルモンを分泌します。チロキシンは甲状腺から分泌されます。"
      },
      {
        id: 48,
        type: "tf",
        question: "成長ホルモンは骨や筋肉の成長を促進し、成長期の身長の伸びにも関わっている。",
        choices: ["正しい", "誤り"],
        correctIndex: 0,
        explanation: "成長ホルモンは骨端線の発育などを通して身長の伸びにも関わります。"
      },
      {
        id: 49,
        type: "tf",
        question: "放出抑制ホルモンは視床下部から分泌される。",
        choices: ["正しい", "誤り"],
        correctIndex: 0,
        explanation: "放出ホルモンと同様に、放出抑制ホルモンも視床下部から分泌され、脳下垂体前葉ホルモンの分泌を抑制します。"
      },
      {
        id: 50,
        type: "tf",
        question: "アドレナリンは副腎皮質から分泌される。",
        choices: ["正しい", "誤り"],
        correctIndex: 1,
        explanation: "アドレナリンは副腎髄質から分泌されます。副腎皮質からは糖質コルチコイドや鉱質コルチコイドが分泌されます。"
      }
    ];

    const STORAGE_KEY = "hormoneQuizStats";

    // stats = { [id]: { attempts, correct, incorrect } }
    let stats = {};

    function loadStats() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) {
          stats = {};
        } else {
          const parsed = JSON.parse(raw);
          stats = parsed && typeof parsed === "object" ? parsed : {};
        }
      } catch (e) {
        stats = {};
      }
    }

    function saveStats() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(stats));
      } catch (e) {
        // ignore
      }
    }

    function resetStats() {
      stats = {};
      saveStats();
    }

    function shuffleArray(array) {
      const arr = array.slice();
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    let shuffledQuestions = [];
    let currentIndex = 0;
    let score = 0;
    let answered = false;
    let currentMode = "all"; // all | mc | tf | review
    let currentChoiceOrder = [];

    const questionNumberEl = document.getElementById("question-number");
    const totalQuestionsEl = document.getElementById("total-questions");
    const scoreEl = document.getElementById("score");
    const questionTextEl = document.getElementById("question-text");
    const choicesListEl = document.getElementById("choices-list");
    const feedbackEl = document.getElementById("feedback");
    const wrongCountEl = document.getElementById("wrong-count");
    const explanationEl = document.getElementById("explanation");
    const nextBtn = document.getElementById("next-btn");
    const restartBtn = document.getElementById("restart-btn");
    const resetStatBtn = document.getElementById("reset-stat-btn");
    const modeRadios = document.querySelectorAll("input[name='mode']");
    const bodyEl = document.body;
    const appCardEl = document.getElementById("app-card");
    const reviewLabelEl = document.querySelector("label[for='mode-review']");

    modeRadios.forEach(radio => {
      radio.addEventListener("change", () => {
        currentMode = radio.value;
        startQuiz();
      });
    });

    function updateModeStyles() {
      if (currentMode === "review") {
        bodyEl.classList.add("review-mode");
        appCardEl.classList.add("review-mode");
        if (reviewLabelEl) reviewLabelEl.classList.add("active");
      } else {
        bodyEl.classList.remove("review-mode");
        appCardEl.classList.remove("review-mode");
        if (reviewLabelEl) reviewLabelEl.classList.remove("active");
      }
    }

    function filteredQuestionsByMode(mode) {
      if (mode === "mc") return QUESTIONS.filter(q => q.type === "mc");
      if (mode === "tf") return QUESTIONS.filter(q => q.type === "tf");
      if (mode === "review") {
        const wrongs = QUESTIONS.filter(q => {
          const s = stats[q.id];
          return s && s.incorrect > 0;
        });
        wrongs.sort((a, b) => {
          const sa = stats[a.id] ? stats[a.id].incorrect : 0;
          const sb = stats[b.id] ? stats[b.id].incorrect : 0;
          return sb - sa;
        });
        return wrongs;
      }
      return QUESTIONS.slice();
    }

    function startQuiz() {
      updateModeStyles();

      const base = filteredQuestionsByMode(currentMode);

      if (currentMode === "review") {
        // 復習モード：間違えたものをすべて出題
        if (base.length === 0) {
          shuffledQuestions = [];
          currentIndex = 0;
          score = 0;
          scoreEl.textContent = score;
          totalQuestionsEl.textContent = 0;
          showNoReviewMessage();
          return;
        }
        shuffledQuestions = shuffleArray(base);
      } else {
        // 通常モード：プールからランダム20問
        const shuffledBase = shuffleArray(base);
        const limit = Math.min(20, shuffledBase.length);
        shuffledQuestions = shuffledBase.slice(0, limit);
      }

      currentIndex = 0;
      score = 0;
      scoreEl.textContent = score;
      totalQuestionsEl.textContent = shuffledQuestions.length;
      loadQuestion();
    }

    function showNoReviewMessage() {
      questionNumberEl.textContent = "-";
      questionTextEl.textContent =
        "まだ「間違えた問題」の記録がありません。まずは通常モードで20問チャレンジしてみましょう。";
      choicesListEl.innerHTML = "";
      feedbackEl.textContent = "";
      feedbackEl.className = "";
      wrongCountEl.textContent = "";
      explanationEl.textContent = "";
      explanationEl.classList.remove("visible");
      nextBtn.disabled = true;
      nextBtn.textContent = "次の問題へ ▶";
    }

    function loadQuestion() {
      answered = false;
      nextBtn.disabled = true;
      feedbackEl.textContent = "";
      feedbackEl.className = "";
      wrongCountEl.textContent = "";
      explanationEl.textContent = "";
      explanationEl.classList.remove("visible");

      const q = shuffledQuestions[currentIndex];
      questionNumberEl.textContent = currentIndex + 1;
      questionTextEl.textContent = q.question;

      const s = stats[q.id];
      const wrongTimes = s ? s.incorrect || 0 : 0;
      if (wrongTimes > 0) {
        wrongCountEl.textContent = `この問題を間違えた回数：${wrongTimes}回`;
      } else {
        wrongCountEl.textContent = "";
      }

      const originalIndices = q.choices.map((_, idx) => idx);
      currentChoiceOrder = shuffleArray(originalIndices);

      choicesListEl.innerHTML = "";
      currentChoiceOrder.forEach((choiceIndex, displayIdx) => {
        const li = document.createElement("li");
        const btn = document.createElement("button");
        btn.className = "choice-btn";
        const labelPrefix = q.type === "mc" ? (displayIdx + 1) + "． " : "";
        btn.textContent = labelPrefix + q.choices[choiceIndex];
        btn.addEventListener("click", () => handleChoiceClick(choiceIndex));
        li.appendChild(btn);
        choicesListEl.appendChild(li);
      });

      nextBtn.textContent = "次の問題へ ▶";
    }

    function updateStats(q, isCorrect) {
      if (!stats[q.id]) {
        stats[q.id] = { attempts: 0, correct: 0, incorrect: 0 };
      }
      stats[q.id].attempts += 1;
      if (isCorrect) {
        stats[q.id].correct += 1;
      } else {
        stats[q.id].incorrect += 1;
      }
      saveStats();
    }

    function handleChoiceClick(selectedOriginalIndex) {
      if (answered) return;
      answered = true;

      const q = shuffledQuestions[currentIndex];
      const allButtons = document.querySelectorAll(".choice-btn");

      allButtons.forEach((btn, displayIdx) => {
        btn.disabled = true;
        const originalIndex = currentChoiceOrder[displayIdx];

        if (originalIndex === q.correctIndex) {
          btn.classList.add("correct");
        }
        if (originalIndex === selectedOriginalIndex && originalIndex !== q.correctIndex) {
          btn.classList.add("incorrect");
        }
      });

      const isCorrect = selectedOriginalIndex === q.correctIndex;
      updateStats(q, isCorrect);

      if (isCorrect) {
        feedbackEl.textContent = "◎ 正解です！";
        feedbackEl.className = "correct";
        score++;
        scoreEl.textContent = score;
      } else {
        feedbackEl.textContent = "× 不正解です。";
        feedbackEl.className = "incorrect";
      }

      const s = stats[q.id];
      if (s && s.incorrect > 0) {
        wrongCountEl.textContent = `この問題を間違えた回数：${s.incorrect}回`;
      }

      explanationEl.innerHTML = "<strong>【解説】</strong><br>" + (q.explanation || "");
      explanationEl.classList.add("visible");

      nextBtn.disabled = false;
      if (currentIndex === shuffledQuestions.length - 1) {
        nextBtn.textContent = "結果を表示";
      }
    }

    nextBtn.addEventListener("click", () => {
      if (currentIndex < shuffledQuestions.length - 1) {
        currentIndex++;
        loadQuestion();
      } else {
        showResult();
      }
    });

    function showResult() {
      questionTextEl.textContent = "お疲れさまでした！ 今回の問題はこれで終了です。";
      choicesListEl.innerHTML = "";
      feedbackEl.className = "";
      feedbackEl.textContent = "";
      wrongCountEl.textContent = "";
      explanationEl.classList.add("visible");
      explanationEl.innerHTML = `今回の正答数は <strong>${score} / ${shuffledQuestions.length}</strong> でした。`;
      nextBtn.disabled = true;
      nextBtn.textContent = "終了";
    }

    restartBtn.addEventListener("click", () => {
      startQuiz();
    });

    resetStatBtn.addEventListener("click", () => {
      const ok = confirm("この端末に保存されている「よく間違える問題」の履歴をすべて消去しますか？");
      if (!ok) return;
      resetStats();
      if (currentMode === "review") {
        startQuiz();
      }
    });

    loadStats();
    startQuiz();
  </script>
</body>
</html>
